<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>接龙检查</title>
    <!-- 改为本地字体图标 -->
    <link rel="stylesheet" href="all.min.css">
    <style>
        :root {
            --primary-color: #07c160;
            --primary-dark: #05a049;
            --danger-color: #ff4757;
            --warning-color: #ffa502;
            --light-bg: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-light: #666666;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 10px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        h1:hover {
            transform: scale(1.05);
        }
        
        .description {
            font-size: 16px;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }
        
        .quick-action {
            margin-top: 20px;
            display: flex;
            justify-content: center;
        }
        
        .quick-action-btn {
            padding: 12px 24px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .quick-action-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .quick-action-btn:active {
            transform: translateY(-1px);
        }
        
        .quick-action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            flex: 1;
            min-width: 300px;
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }
        
        .panel:hover {
            transform: translateY(-5px);
        }
        
        .panel h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .panel h2 i {
            margin-right: 8px;
        }
        
        .panel h2 span {
            font-size: 14px;
            color: var(--text-light);
            font-weight: normal;
        }
        
        textarea {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            resize: vertical;
            font-size: 15px;
            line-height: 1.5;
            transition: all 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(7, 193, 96, 0.2);
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        button.secondary {
            background-color: #f0f0f0;
            color: var(--text-color);
        }
        
        button.secondary:hover {
            background-color: #e0e0e0;
        }
        
        button.danger {
            background-color: var(--danger-color);
        }
        
        button.danger:hover {
            background-color: #ff3742;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            padding: 10px 20px;
            background-color: #f0f0f0;
            color: var(--text-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-label:hover {
            background-color: #e0e0e0;
        }
        
        .result-panel {
            width: 100%;
        }
        
        .result-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .result-box {
            flex: 1;
            min-width: 300px;
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .result-box h3 {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .result-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 6px;
        }
        
        .result-item {
            padding: 8px 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .result-item.missing {
            border-left-color: var(--danger-color);
            background-color: #fff5f5;
        }
        
        .result-item .index {
            color: var(--text-light);
            font-size: 14px;
        }
        
        .statistics {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            text-align: center;
        }
        
        .stat-item {
            padding: 15px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 5px;
        }
        
        .stat-value.missing {
            color: var(--danger-color);
        }
        
        .visualization {
            margin-top: 30px;
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .chart-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            margin-top: 20px;
        }
        
        .chart {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(
                var(--primary-color) 0% var(--joined-percent), 
                var(--danger-color) var(--joined-percent) 100%
            );
            position: relative;
        }
        
        .chart-center {
            position: absolute;
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .chart-percent {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .chart-label {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .history-panel {
            margin-top: 30px;
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .history-item {
            padding: 10px 15px;
            border-left: 3px solid var(--primary-color);
            background: #f9f9f9;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-item:hover {
            background: #f0f0f0;
        }
        
        .history-info {
            display: flex;
            gap: 15px;
        }
        
        .history-date {
            font-weight: bold;
        }
        
        .history-stats {
            color: var(--text-light);
            font-size: 14px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--text-light);
            font-size: 14px;
            border-top: 1px solid var(--border-color);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .panel {
                width: 100%;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button, .file-label {
                width: 100%;
                justify-content: center;
            }
            
            .statistics {
                flex-wrap: wrap;
            }
            
            .stat-item {
                flex: 1;
                min-width: 45%;
            }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--primary-color);
            color: white;
            border-radius: 6px;
            box-shadow: var(--shadow);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: var(--danger-color);
        }
        
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .progress-bar {
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .textarea-container {
            position: relative;
        }
        
        .paste-button {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 8px 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 10;
        }
        
        .paste-button:hover {
            background-color: var(--primary-dark);
        }
        
        .permission-hint {
            margin-top: 10px;
            font-size: 14px;
            color: var(--text-light);
            text-align: center;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        /* 图片模态框样式 */
        .image-modal-content {
            max-width: 90%;
            max-height: 90%;
            width: auto;
            height: auto;
            padding: 0;
            background: transparent;
            box-shadow: none;
        }

        .image-modal-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-title {
            font-size: 20px;
            color: var(--primary-color);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
        }
        
        .modal-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .modal-item {
            padding: 8px 12px;
            margin-bottom: 8px;
            background: #f9f9f9;
            border-radius: 4px;
            border-left: 4px solid var(--danger-color);
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-dragon"></i> 接龙统计</h1>
        
        <p class="description">智能识别 快速检出 支持模糊匹配 批量操作</p>
        </div>
        
        <div class="permission-hint">
            伏羲智眼  © 
        </div>
    </header>
    
    <div class="button-group">
            <button id="quickCopyBtn"><i class="fas fa-bolt"></i> 一键复制未接龙名单[预设匹配]</button>
    
    
    
    <div class="container">
        <div class="panel">
            <h2><i class="fas fa-list-ol"></i> 接龙内容 <span>粘贴后点击网页下方检查按钮</span></h2>
            <div class="textarea-container">
                <textarea id="relayContent" placeholder="请复制接龙内容粘贴到这里，或点击下方粘贴按钮从剪贴板粘贴..."></textarea>
            </div>
            <div class="button-group">
                <button id="pasteFromClipboard"><i class="fas fa-paste"></i> 粘贴</button>
                <button id="clearRelay"><i class="fas fa-eraser"></i> 清空</button>
                <button id="pasteRelay"><i class="fas fa-paste"></i> 粘贴示例</button>
                <input type="file" id="importRelay" class="file-input" accept=".txt">
                <label for="importRelay" class="file-label"><i class="fas fa-file-import"></i> 导入接龙[.txt文件]</label>
            </div>
        </div>
        
        <div class="panel">
            <h2><i class="fas fa-users"></i> 名单池 <span>默认加载本地名单 [可手动修改 一行一个]</span></h2>
            <textarea id="nameList">正在加载名单...</textarea>
            <div class="button-group">
                <button id="clearList"><i class="fas fa-trash"></i> 清空名单</button>
                <button id="restoreList"><i class="fas fa-redo"></i> 恢复默认名单</button>
                <input type="file" id="importList" class="file-input" accept=".txt">
                <label for="importList" class="file-label"><i class="fas fa-file-import"></i> 导入名单[.txt文件]</label>
                <button id="exportList" class="secondary"><i class="fas fa-file-export"></i> 导出名单[.txt文件]</button>
            </div>
        </div>
    </div>
    
    <div class="button-group" style="justify-content: center; margin-bottom: 20px;">
        <button id="checkBtn" style="padding: 12px 30px; font-size: 16px;"><i class="fas fa-search"></i> 检查接龙情况</button>
    </div>
    
    <div class="result-panel">
        <div class="tabs">
            <div class="tab active" data-tab="results">检查结果</div>
            <div class="tab" data-tab="visualization">占比可视化</div>
            <div class="tab" data-tab="history">历史记录</div>
        </div>
        
        <div class="tab-content active" id="results-tab">
            <div class="result-container">
                <div class="result-box">
                    <h3><i class="fas fa-check-circle"></i> 已接龙人员 (<span id="joinedCount">0</span>人)</h3>
                    <div class="result-list" id="joinedList">
                        <!-- 已接龙人员将在这里显示 -->
                    </div>
                </div>
                
                <div class="result-box">
                    <h3><i class="fas fa-times-circle"></i> 未接龙人员 (<span id="missingCount">0</span>人)</h3>
                    <div class="result-list" id="missingList">
                        <!-- 未接龙人员将在这里显示 -->
                    </div>
                </div>
            </div>
            
            <div class="statistics">
                <div class="stat-item">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">总人数</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="joinedStat">0</div>
                    <div class="stat-label">已接龙</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value missing" id="missingStat">0</div>
                    <div class="stat-label">未接龙</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="percentage">0%</div>
                    <div class="stat-label">接龙率</div>
                </div>
            </div>
            
            <div class="button-group" style="justify-content: center; margin-top: 20px;">
                <button id="copyMissing" class="secondary"><i class="fas fa-copy"></i> 复制未接龙名单</button>
                <button id="copyJoined" class="secondary"><i class="fas fa-copy"></i> 复制已接龙名单</button>
                <button id="exportResults" class="secondary"><i class="fas fa-file-export"></i> 导出检查结果[.txt文件]</button>
                <button id="saveHistory" class="secondary"><i class="fas fa-save"></i> 保存记录</button>
            </div>
        </div>
        
        <div class="tab-content" id="visualization-tab">
            <div class="visualization">
                <h3><i class="fas fa-chart-pie"></i> 接龙情况统计</h3>
                <div class="chart-container">
                    <div class="chart">
                        <div class="chart-center">
                            <div class="chart-percent" id="chartPercent">0%</div>
                            <div class="chart-label">接龙率</div>
                        </div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="history-tab">
            <div class="history-panel">
                <h3><i class="fas fa-history"></i> 历史记录</h3>
                <div class="button-group">
                    <button id="clearHistory" class="danger"><i class="fas fa-trash"></i> 清空历史</button>
                </div>
                <div class="history-list" id="historyList">
                    <!-- 历史记录将在这里显示 -->
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>伏羲智眼 &copy;</p>
    </footer>

    <!-- 未接龙名单弹窗 -->
    <div class="modal" id="missingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-times-circle"></i> 未接龙人员名单</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-list" id="modalMissingList">
                <!-- 弹窗中的未接龙人员将在这里显示 -->
            </div>
            <div class="button-group" style="margin-top: 20px;">
                <button id="modalCopyMissing" class="secondary"><i class="fas fa-copy"></i> 复制名单</button>
                <button class="close-modal secondary">关闭</button>
            </div>
        </div>
    </div>

    <!-- 图片弹窗 -->
    <div class="modal" id="imageModal">
        <div class="modal-content image-modal-content">
            <img id="modalImage" src="" alt="图片">
        </div>
    </div>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">操作成功</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM加载完成');
            
            // 获取元素
            const relayContent = document.getElementById('relayContent');
            const nameList = document.getElementById('nameList');
            const checkBtn = document.getElementById('checkBtn');
            const joinedList = document.getElementById('joinedList');
            const missingList = document.getElementById('missingList');
            const totalCount = document.getElementById('totalCount');
            const joinedCount = document.getElementById('joinedCount');
            const missingCount = document.getElementById('missingCount');
            const joinedStat = document.getElementById('joinedStat');
            const missingStat = document.getElementById('missingStat');
            const percentage = document.getElementById('percentage');
            const chartPercent = document.getElementById('chartPercent');
            const progressBar = document.getElementById('progressBar');
            const historyList = document.getElementById('historyList');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const quickCopyBtn = document.getElementById('quickCopyBtn');
            const missingModal = document.getElementById('missingModal');
            const modalMissingList = document.getElementById('modalMissingList');
            const modalCopyMissing = document.getElementById('modalCopyMissing');
            const closeModalButtons = document.querySelectorAll('.close-modal');
            const imageModal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            
            // 按钮元素
            const clearRelay = document.getElementById('clearRelay');
            const pasteRelay = document.getElementById('pasteRelay');
            const pasteFromClipboard = document.getElementById('pasteFromClipboard');
            const clearList = document.getElementById('clearList');
            const restoreList = document.getElementById('restoreList');
            const copyMissing = document.getElementById('copyMissing');
            const copyJoined = document.getElementById('copyJoined');
            const exportList = document.getElementById('exportList');
            const exportResults = document.getElementById('exportResults');
            const saveHistory = document.getElementById('saveHistory');
            const clearHistory = document.getElementById('clearHistory');
            const importRelay = document.getElementById('importRelay');
            const importList = document.getElementById('importList');
            
            // 标签页元素
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            // 默认名单 - 从本地文件加载
            let defaultNameList = "";
            
            // 示例接龙内容
            const exampleRelay = `#接龙
安全到家
0.刘𣲙
12345. 孙浩宇
2. 田佳乐@gmail.com
3. 刘国梁
4. 李政霖？*”“！@”
5. 张启航ABCD
6. 孙亚惠你好
7. 梁丽媛在教室第二排
8. 刘翰荣是学习委员
9. 赵芷萱安全到家
10. 邵铄婷 1234  12 34
11. 王胤淇12341234
12. 张文清
13. 申浩冉
14. 于令坤
15. 赵紫妍
16. 解得海
17. 刘青钺
18. 赵文杰
19. 冯成志
20. 马慧萍
21. 李迎菲
22. 刘泽凯
23. 路艳阳
24. 张佳欣
25. 张鼎皓
26. 张一敏
27. 孟凡超
28. 张艺馨
29. 陈宇彤
30. 刘欣仪
31. 赵芳菲
32. 刘钰宝
33. 王雨晴
34. 宋玉婷
35. 张奥琪
36. 辛浩然
37. 冯玺羽
38. 谭新凝
39. 张文娜
40. 何静怡
41. 贾俊曦
42. 韩德森
43. 袁晓惠`;
            
            // 历史记录
            let history = JSON.parse(localStorage.getItem('relayHistory')) || [];
            
            // 从本地文件加载名单
            async function loadNameListFromFile() {
                try {
                    console.log('尝试从本地文件加载名单...');
                    const response = await fetch('name.txt');
                    if (response.ok) {
                        defaultNameList = await response.text();
                        console.log('成功加载本地名单文件');
                        nameList.value = defaultNameList;
                    } else {
                        throw new Error('无法加载名单文件');
                    }
                } catch (error) {
                    console.error('加载本地名单失败:', error);
                    // 使用内置的默认名单作为备选
                    defaultNameList = `刘泽凯
张启航
王胤淇
李赵晟
孟凡超
袁晓惠
刘青钺
王德锰
于令坤
冯成志
张奥琪
王志诚
张鼎皓
赵芳菲
刘钰宝
韩德森
解得海
田佳乐
李政霖
孙浩宇
赵紫妍
路艳阳
刘静涵
贾俊曦
王义菡
冯玺羽
王雨晴
刘欣仪
马慧萍
张佳欣
张文清
赵芷萱
申浩冉
谭新凝
孙亚惠
刘翰荣
宋玉婷
梁丽媛
陈宇彤
辛浩然
邵铄婷
张艺馨
赵文杰
刘国梁
李迎菲
张一敏
何静怡
张文娜`;
                    nameList.value = defaultNameList;
                    console.log('使用内置默认名单');
                }
            }
            
            // 初始化
            async function init() {
                console.log('初始化应用');
                
                // 首先加载本地名单
                await loadNameListFromFile();
                
                loadHistory();
                updateChart(0);
                
                // 绑定标题点击事件 - 显示图片
                const headerTitle = document.querySelector('header h1');
                if (headerTitle) {
                    headerTitle.addEventListener('click', function() {
                        showImageModal();
                    });
                }
                
                // 绑定一键复制按钮事件
                if (quickCopyBtn) {
                    console.log('找到一键复制按钮');
                    quickCopyBtn.addEventListener('click', handleQuickCopy);
                } else {
                    console.error('未找到一键复制按钮');
                }
                
                // 绑定弹窗关闭按钮事件
                closeModalButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        missingModal.style.display = 'none';
                    });
                });
                
                // 绑定弹窗复制按钮事件
                modalCopyMissing.addEventListener('click', function() {
                    const missingNames = Array.from(missingList.querySelectorAll('.result-item'))
                        .map(item => item.querySelector('span').textContent)
                        .join('\n');
                    
                    if (!missingNames) {
                        showNotification('没有未接龙人员', true);
                        return;
                    }
                    
                    navigator.clipboard.writeText(missingNames)
                        .then(() => {
                            showNotification('未接龙名单已复制到剪贴板');
                            missingModal.style.display = 'none';
                        })
                        .catch(err => {
                            console.error('复制失败: ', err);
                            showNotification('复制失败，请手动复制', true);
                        });
                });
                
                // 点击弹窗外部关闭弹窗
                missingModal.addEventListener('click', function(e) {
                    if (e.target === missingModal) {
                        missingModal.style.display = 'none';
                    }
                });

                // 点击图片弹窗外部关闭弹窗
                imageModal.addEventListener('click', function(e) {
                    if (e.target === imageModal) {
                        imageModal.style.display = 'none';
                    }
                });
            }
            
            // 显示图片弹窗
            function showImageModal() {
                try {
                    // 设置图片源为1.jpg
                    modalImage.src = '1.jpg';
                    // 显示弹窗
                    imageModal.style.display = 'flex';
                    console.log('显示图片弹窗');
                } catch (error) {
                    console.error('加载图片失败:', error);
                    showNotification('无法加载图片', true);
                }
            }
            
            // 显示通知
            function showNotification(message, isError = false) {
                console.log('显示通知:', message, isError);
                notificationText.textContent = message;
                notification.className = 'notification';
                if (isError) {
                    notification.classList.add('error');
                }
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
            
            // 处理一键复制功能
            async function handleQuickCopy() {
                console.log('一键复制按钮被点击');
                
                try {
                    // 显示加载状态
                    quickCopyBtn.innerHTML = '<div class="loader"></div> 处理中...';
                    quickCopyBtn.disabled = true;
                    
                    // 获取名单池
                    const nameText = nameList.value;
                    
                    if (!nameText.trim()) {
                        showNotification('名单池为空，请添加名单', true);
                        quickCopyBtn.innerHTML = '<i class="fas fa-bolt"></i> 一键复制未接龙名单';
                        quickCopyBtn.disabled = false;
                        return;
                    }
                    
                    // 读取剪贴板内容
                    let clipboardText;
                    try {
                        console.log('尝试读取剪贴板');
                        clipboardText = await navigator.clipboard.readText();
                        console.log('剪贴板内容:', clipboardText);
                    } catch (clipboardError) {
                        console.error('剪贴板读取失败: ', clipboardError);
                        showNotification('无法读取剪贴板内容，请确保浏览器支持且已授权', true);
                        quickCopyBtn.innerHTML = '<i class="fas fa-bolt"></i> 一键复制未接龙名单';
                        quickCopyBtn.disabled = false;
                        return;
                    }
                    
                    if (!clipboardText.trim()) {
                        showNotification('剪贴板为空，请复制接龙内容后再试', true);
                        quickCopyBtn.innerHTML = '<i class="fas fa-bolt"></i> 一键复制未接龙名单';
                        quickCopyBtn.disabled = false;
                        return;
                    }
                    
                    // 处理名单
                    const names = nameText.split('\n')
                        .map(name => name.trim())
                        .filter(name => name.length > 0);
                    
                    // 处理接龙内容
                    const relayLines = clipboardText.split('\n')
                        .map(line => line.trim())
                        .filter(line => line.length > 0);
                    
                    // 找出已接龙和未接龙的人员
                    const joined = [];
                    const missing = [];
                    
                    names.forEach(name => {
                        let found = false;
                        
                        for (const line of relayLines) {
                            // 使用模糊匹配，允许部分匹配
                            if (fuzzyMatch(line, name)) {
                                found = true;
                                break;
                            }
                        }
                        
                        if (found) {
                            joined.push(name);
                        } else {
                            missing.push(name);
                        }
                    });
                    
                    // 更新界面显示
                    updateResults(joined, missing);
                    
                    // 更新弹窗内容
                    updateModalContent(missing);
                    
                    // 将未接龙名单写入剪贴板
                    if (missing.length > 0) {
                        try {
                            console.log('准备写入剪贴板:', missing);
                            await navigator.clipboard.writeText(missing.join('\n'));
                            showNotification(`已复制 ${missing.length} 个未接龙人员到剪贴板`);
                            
                            // 显示弹窗
                            missingModal.style.display = 'flex';
                        } catch (writeError) {
                            console.error('剪贴板写入失败: ', writeError);
                            showNotification('无法写入剪贴板，请确保浏览器支持且已授权', true);
                        }
                    } else {
                        showNotification('所有人员均已接龙，无需复制', true);
                    }
                    
                    // 恢复按钮状态
                    quickCopyBtn.innerHTML = '<i class="fas fa-bolt"></i> 一键复制未接龙名单';
                    quickCopyBtn.disabled = false;
                    
                } catch (err) {
                    console.error('一键复制失败: ', err);
                    showNotification('操作失败，请检查浏览器权限或重试', true);
                    
                    // 恢复按钮状态
                    quickCopyBtn.innerHTML = '<i class="fas fa-bolt"></i> 一键复制未接龙名单';
                    quickCopyBtn.disabled = false;
                }
            }
            
            // 更新弹窗内容
            function updateModalContent(missing) {
                modalMissingList.innerHTML = '';
                
                if (missing.length === 0) {
                    modalMissingList.innerHTML = '<div class="modal-item">所有人员均已接龙</div>';
                    return;
                }
                
                missing.forEach((name, index) => {
                    const item = document.createElement('div');
                    item.className = 'modal-item';
                    item.innerHTML = `
                        <span>${index + 1}. ${name}</span>
                    `;
                    modalMissingList.appendChild(item);
                });
            }
            
            // 标签页切换
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // 移除所有active类
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // 添加active类到当前标签
                    tab.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // 从剪贴板粘贴内容
            pasteFromClipboard.addEventListener('click', async function() {
                try {
                    const text = await navigator.clipboard.readText();
                    relayContent.value = text;
                    showNotification('已从剪贴板粘贴接龙内容');
                } catch (err) {
                    console.error('无法读取剪贴板内容: ', err);
                    showNotification('无法读取剪贴板内容，请确保浏览器支持且已授权', true);
                }
            });
            
            // 清空接龙内容
            clearRelay.addEventListener('click', function() {
                relayContent.value = '';
                showNotification('接龙内容已清空');
            });
            
            // 粘贴示例接龙
            pasteRelay.addEventListener('click', function() {
                relayContent.value = exampleRelay;
                showNotification('示例接龙内容已加载');
            });
            
            // 清空名单
            clearList.addEventListener('click', function() {
                nameList.value = '';
                showNotification('名单已清空');
            });
            
            // 恢复默认名单
            restoreList.addEventListener('click', function() {
                nameList.value = defaultNameList;
                showNotification('默认名单已恢复');
            });
            
            // 导入接龙内容
            importRelay.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    relayContent.value = e.target.result;
                    showNotification('接龙内容已导入');
                };
                reader.readAsText(file);
                
                // 重置文件输入，允许再次选择同一文件
                e.target.value = '';
            });
            
            // 导入名单
            importList.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    nameList.value = e.target.result;
                    showNotification('名单已导入');
                };
                reader.readAsText(file);
                
                // 重置文件输入
                e.target.value = '';
            });
            
            // 导出名单 - 修复编码问题
            exportList.addEventListener('click', function() {
                const content = nameList.value;
                // 添加UTF-8 BOM以解决中文乱码问题
                const BOM = '\uFEFF';
                const blob = new Blob([BOM + content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = '名单导出.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification('名单已导出');
            });
            
            // 检查接龙情况
            checkBtn.addEventListener('click', function() {
                const relayText = relayContent.value;
                const nameText = nameList.value;
                
                if (!relayText.trim()) {
                    showNotification('请输入接龙内容', true);
                    return;
                }
                
                if (!nameText.trim()) {
                    showNotification('请输入名单', true);
                    return;
                }
                
                // 显示加载状态
                const originalText = checkBtn.innerHTML;
                checkBtn.innerHTML = '<div class="loader"></div> 检查中...';
                checkBtn.disabled = true;
                
                // 模拟动画时间
                setTimeout(() => {
                    // 处理名单
                    const names = nameText.split('\n')
                        .map(name => name.trim())
                        .filter(name => name.length > 0);
                    
                    // 处理接龙内容
                    const relayLines = relayText.split('\n')
                        .map(line => line.trim())
                        .filter(line => line.length > 0);
                    
                    // 找出已接龙和未接龙的人员
                    const joined = [];
                    const missing = [];
                    
                    names.forEach(name => {
                        let found = false;
                        
                        for (const line of relayLines) {
                            // 使用模糊匹配，允许部分匹配
                            if (fuzzyMatch(line, name)) {
                                found = true;
                                break;
                            }
                        }
                        
                        if (found) {
                            joined.push(name);
                        } else {
                            missing.push(name);
                        }
                    });
                    
                    // 更新UI
                    updateResults(joined, missing);
                    
                    // 恢复按钮状态
                    checkBtn.innerHTML = originalText;
                    checkBtn.disabled = false;
                    
                    showNotification('接龙检查完成');
                }, 100);
            });
            
            // 模糊匹配函数
            function fuzzyMatch(text, name) {
                // 简单实现：检查姓名是否在文本中出现
                // 更复杂的实现可以使用编辑距离算法
                return text.includes(name);
            }
            
            // 更新结果显示
            function updateResults(joined, missing) {
                // 清空现有结果
                joinedList.innerHTML = '';
                missingList.innerHTML = '';
                
                // 添加已接龙人员
                joined.forEach((name, index) => {
                    const item = document.createElement('div');
                    item.className = 'result-item';
                    item.innerHTML = `
                        <span>${name}</span>
                        <span class="index">${index + 1}</span>
                    `;
                    joinedList.appendChild(item);
                });
                
                // 添加未接龙人员
                missing.forEach((name, index) => {
                    const item = document.createElement('div');
                    item.className = 'result-item missing';
                    item.innerHTML = `
                        <span>${name}</span>
                        <span class="index">${index + 1}</span>
                    `;
                    missingList.appendChild(item);
                });
                
                // 更新统计数据
                const total = joined.length + missing.length;
                const joinedPercentage = total > 0 ? Math.round((joined.length / total) * 100) : 0;
                
                totalCount.textContent = total;
                joinedCount.textContent = joined.length;
                missingCount.textContent = missing.length;
                joinedStat.textContent = joined.length;
                missingStat.textContent = missing.length;
                percentage.textContent = `${joinedPercentage}%`;
                
                // 更新图表
                updateChart(joinedPercentage);
            }
            
            // 更新图表
            function updateChart(percentage) {
                chartPercent.textContent = `${percentage}%`;
                progressBar.style.width = `${percentage}%`;
                
                // 更新饼图
                const chart = document.querySelector('.chart');
                chart.style.background = `conic-gradient(
                    var(--primary-color) 0% ${percentage}%, 
                    var(--danger-color) ${percentage}% 100%
                )`;
            }
            
            // 复制未接龙名单
            copyMissing.addEventListener('click', function() {
                const missingNames = Array.from(missingList.querySelectorAll('.result-item'))
                    .map(item => item.querySelector('span').textContent)
                    .join('\n');
                
                if (!missingNames) {
                    showNotification('没有未接龙人员', true);
                    return;
                }
                
                navigator.clipboard.writeText(missingNames)
                    .then(() => showNotification('未接龙名单已复制到剪贴板'))
                    .catch(err => {
                        console.error('复制失败: ', err);
                        showNotification('复制失败，请手动复制', true);
                    });
            });
            
            // 复制已接龙名单
            copyJoined.addEventListener('click', function() {
                const joinedNames = Array.from(joinedList.querySelectorAll('.result-item'))
                    .map(item => item.querySelector('span').textContent)
                    .join('\n');
                
                if (!joinedNames) {
                    showNotification('没有已接龙人员', true);
                    return;
                }
                
                navigator.clipboard.writeText(joinedNames)
                    .then(() => showNotification('已接龙名单已复制到剪贴板'))
                    .catch(err => {
                        console.error('复制失败: ', err);
                        showNotification('复制失败，请手动复制', true);
                    });
            });
            
            // 导出检查结果 - 修复编码问题
            exportResults.addEventListener('click', function() {
                const joinedNames = Array.from(joinedList.querySelectorAll('.result-item'))
                    .map(item => item.querySelector('span').textContent)
                    .join('\n');
                
                const missingNames = Array.from(missingList.querySelectorAll('.result-item'))
                    .map(item => item.querySelector('span').textContent)
                    .join('\n');
                
                const total = parseInt(totalCount.textContent);
                const joined = parseInt(joinedStat.textContent);
                const missing = parseInt(missingStat.textContent);
                const percent = percentage.textContent;
                
                const resultText = `接龙检查结果
统计时间: ${new Date().toLocaleString()}
总人数: ${total}
已接龙数: ${joined}
未接龙数: ${missing}
接龙率: ${percent}

===== 已接龙人员 =====
${joinedNames || "无"}

===== 未接龙人员 =====
${missingNames || "无"}
`;
                // 添加UTF-8 BOM以解决中文乱码问题
                const BOM = '\uFEFF';
                const blob = new Blob([BOM + resultText], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `接龙检查结果_${new Date().toISOString().slice(0,10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification('检查结果已导出');
            });
            
            // 保存历史记录
            saveHistory.addEventListener('click', function() {
                const total = parseInt(totalCount.textContent);
                const joined = parseInt(joinedStat.textContent);
                const missing = parseInt(missingStat.textContent);
                const percent = percentage.textContent;
                
                if (total === 0) {
                    showNotification('没有检查结果可保存', true);
                    return;
                }
                
                const record = {
                    id: Date.now(),
                    date: new Date().toLocaleString(),
                    total: total,
                    joined: joined,
                    missing: missing,
                    percent: percent
                };
                
                history.unshift(record);
                
                // 只保留最近10条记录
                if (history.length > 10) {
                    history = history.slice(0, 10);
                }
                
                localStorage.setItem('relayHistory', JSON.stringify(history));
                loadHistory();
                showNotification('检查记录已保存');
            });
            
            // 加载历史记录
            function loadHistory() {
                historyList.innerHTML = '';
                
                if (history.length === 0) {
                    historyList.innerHTML = '<div class="history-item">暂无历史记录</div>';
                    return;
                }
                
                history.forEach(record => {
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    item.innerHTML = `
                        <div class="history-info">
                            <span class="history-date">${record.date}</span>
                            <span class="history-stats">${record.total}人 / ${record.joined}已接 / ${record.missing}未接</span>
                        </div>
                        <span class="history-stats">${record.percent}</span>
                    `;
                    historyList.appendChild(item);
                });
            }
            
            // 清空历史记录
            clearHistory.addEventListener('click', function() {
                if (history.length === 0) {
                    showNotification('没有历史记录可清空', true);
                    return;
                }
                
                if (confirm('确定要清空所有历史记录吗？此操作不可恢复。')) {
                    history = [];
                    localStorage.setItem('relayHistory', JSON.stringify(history));
                    loadHistory();
                    showNotification('历史记录已清空');
                }
            });
            
            // 初始化
            init();
        });
    </script>
</body>
</html>